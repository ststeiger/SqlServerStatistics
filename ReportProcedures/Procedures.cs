
// using Microsoft.SqlServer.Server;
// using System.Data.SqlTypes;

// using System.Data.SqlClient;


//using System; using System.Data; using System.Data.SqlClient; using Microsoft.SqlServer.Server;
//  See more at: http://www.sqlteam.com/article/writing-clr-stored-procedures-in-charp-returning-data-part-2#sthash.U5dv6ARC.dpuf


namespace ReportProcedures
{


    public class Procedures
    {

        // sp_configure 'show advanced options', 1;
        // GO
        // RECONFIGURE;
        // GO

        // sp_configure 'clr enabled', 1;
        // GO
        // RECONFIGURE;
        // GO

        // sp_configure 'show advanced options', 0;
        // GO
        // RECONFIGURE;
        // GO

        // EXEC sp_changedbowner 'sa'
        // ALTER DATABASE TestDb SET TRUSTWORTHY ON;


        // CREATE ASSEMBLY [ReportProcedures]
        // AUTHORIZATION [dbo]
        // FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300EA7FD5560000000000000000E00002210B010B00001E00000006000000000000CE3D0000002000000040000000000010002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000803D00004B000000004000007003000000000000000000000000000000000000006000000C000000483C00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000D41D000000200000001E000000020000000000000000000000000000200000602E7273726300000070030000004000000004000000200000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000002400000000000000000000000000004000004200000000000000000000000000000000B03D000000000000480000000200050068280000E013000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B300200B600000001000011007201000070731100000A0A00066F1200000A0B0007066F1300000A000772310000706F1400000A0007731500000A0C00731600000A0D0008096F1700000A260928050000060000DE120914FE01130411042D07096F1800000A00DC0000DE120814FE01130411042D07086F1800000A00DC0000DE120714FE01130411042D07076F1800000A00DC00066F1900000A16FE01130411042D07066F1A00000A0000DE120614FE01130411042D07066F1800000A00DC002A00000134000002003700134A00120000000002003000306000120000000002001400627600120000000002000C0096A20012000000001B3002008D00000002000011007201000070731100000A0A00066F1200000A0B0007066F1300000A000772310000706F1400000A00066F1900000A17FE010D092D07066F1B00000A00076F1C00000A0C281D00000A086F1E00000A0000DE100714FE010D092D07076F1800000A00DC00066F1900000A16FE010D092D07066F1A00000A0000DE100614FE010D092D07066F1800000A00DC002A000000011C0000020014003F5300100000000002000C006F7B0010000000001B300200CE00000003000011007201000070731100000A0A00731F00000A0B72650000701F0C732000000A0C72810000701F0C732000000A0D08028C030000016F2100000A0009038C030000016F2100000A00076F2200000A086F2300000A26076F2200000A096F2300000A26728D00007013041104282400000A000772F40100706F1400000A0007066F1300000A00066F1900000A17FE01130511052D07066F1B00000A00076F2500000A26066F1900000A16FE01130511052D07066F1A00000A0000DE120614FE01130511052D07066F1800000A00DC002A00000110000002000C00AEBA0012000000001E02282600000A2A1B300400360100000400001100026F2700000A6F2800000A732900000A0A00026F2700000A6F2A00000A13062B3511066F2B00000A742D0000010B00076F2C00000A076F2D00000A280C000006076F2E00000A6A732F00000A0C06086F3000000A000011066F3100000A130711072DBEDE1D1106751F0000011308110814FE01130711072D0811086F1800000A00DC00066F3200000A733300000A0D281D00000A096F3400000A0000026F3500000A6F2A00000A13062B5111066F2B00000A74300000011304001613052B1B0009110511046F3600000A11059A6F3700000A00001105175813051105026F2700000A6F2800000AFE04130711072DD0281D00000A096F3800000A000011066F3100000A130711072DA2DE1D1106751F0000011308110814FE01130711072D0811086F1800000A00DC00281D00000A6F3900000A002A0000011C0000020020004666001D000000000200AA00620C011D0000000013300400BA01000005000011733A00000A8001000004001200D031000001283B00000A19182811000006007E01000004066F3C00000A001200D033000001283B00000A1E1F142811000006007E01000004066F3C00000A001200D00300001B283B00000A171D2811000006007E01000004066F3C00000A001200D034000001283B00000A1C1A2811000006007E01000004066F3C00000A001200D035000001283B00000A1D1B2811000006007E01000004066F3C00000A001200D036000001283B00000A1E1C2811000006007E01000004066F3C00000A001200D037000001283B00000A1F091F0E2811000006007E01000004066F3C00000A001200D038000001283B00000A1F0A1F102811000006007E01000004066F3C00000A001200D039000001283B00000A1F0B1E2811000006007E01000004066F3C00000A001200D03A000001283B00000A1F0C162811000006007E01000004066F3C00000A001200D001000001283B00000A1F0D1F172811000006007E01000004066F3C00000A001200D03B000001283B00000A1F101F162811000006007E01000004066F3C00000A001200D03B000001283B00000A1F101F0C2811000006007E01000004066F3C00000A00002A2A02282600000A0000002A0000001330010014000000060000110002280F0000060A12007B020000040B2B00072A133001001400000006000011000228100000060A12007B020000040B2B00072A1330010014000000070000110002280E0000060A12007B030000040B2B00072A133001001400000007000011000228100000060A12007B030000040B2B00072A1330010014000000080000110002280E0000060A12007B040000040B2B00072A1330010014000000080000110002280F0000060A12007B040000040B2B00072A1B3002005A0000000900001100007E010000046F3D00000A0C2B201202283E00000A0A0012007B0200000402FE0116FE010D092D0500060BDE29001202283F00000A0D092DD5DE0F1202FE160400001B6F1800000A00DC0072ED020070734000000A7A00072A00000110000002000D002F3C000F000000001B3002005A0000000900001100007E010000046F3D00000A0C2B201202283E00000A0A0012007B0300000402FE0116FE010D092D0500060BDE29001202283F00000A0D092DD5DE0F1202FE160400001B6F1800000A00DC00722B030070734000000A7A00072A00000110000002000D002F3C000F000000001B3002005A0000000900001100007E010000046F3D00000A0C2B201202283E00000A0A0012007B0400000402FE0116FE010D092D0500060BDE29001202283F00000A0D092DD5DE0F1202FE160400001B6F1800000A00DC00726D030070734000000A7A00072A00000110000002000D002F3C000F000000005E0002037D0200000402047D0300000402057D040000042A42534A4201000100000000000C00000076322E302E35303732370000000005006C000000D0050000237E00003C0600005807000023537472696E677300000000940D0000B8030000235553004C1100001000000023475549440000005C1100008402000023426C6F620000000000000002000001571502080902000000FA253300160000010000003F0000000500000004000000110000000F0000004100000010000000090000000400000001000000030000000100000000000A0001000000000006008E0087000600950087000A00DC00C7000A00FE00BB00060039011E010600530187000A005801BB000A006901BB000600CB01B9010600E201B9010600FF01B90106001E02B90106003702B90106005002B90106006B02B90106008602B9010600BE029F020600D2029F020600E002B9010600F902B90106002903160357003D03000006006C034C0306008C034C030A00C503AA030A00F103DB030A00FF03DB030A003A0427040A005404DB030A00630427040600760487000A008A0427040A009704BB000A00BC04DB030A00D804AA030A00E304AA030A00F904DB030A00060527040A001C05DB030E00460516030A006605BB000A008705BB000A00AC05AA030600CB05B8050A00F105BB000A003706AA030A005606BB000A007106BB000600AE0687000600B60687000600DA0687000600DF0687000600E80687000600F00687000600F70687000600FC06870006000207870006000807870006000E078700170015070000060020078700060035079F0206004B079F020000000001000000000001000100010010001F002A00050001000100810110003B00470005000100050001010000610047000500010006000B0110006F000000090002001100310040012000060053016700060058016B00060069016F0050200000000096009F000A0001004821000000009600AF000A0001000022000000009600E6000E000100EC22000000008618F80016000300F42200000000960008011A00030054240000000091184C010A0004001A26000000008118F8001600040028260000000096005F012800040048260000000096005F012F0005006826000000009600730136000600882600000000960073013D000700A8260000000096007C0144000800C8260000000096007C014B000900E826000000009100880152000A006027000000009100880159000B00D827000000009100880160000C005028000000008618F80073000D00000001008D01000002009A01000001009F0100000100A30100000100AA0100000100B40100000100AA0100000100B40100000100A30100000100B40100000100A30100000100AA0100000100B40100000200A30100000300AA014900F8007D005100F8007D005900F8007D006100F8007D006900F8007D007100F8007D007900F8007D008100F8007D008900F80082009100F8007D009900F8007D00A100F8007D00A900F8008700B900F8008D00C100F8001600C900F8001600D100F8007D00D1000A049700D90018049C00E10044047D00E900F800A2002100F8001600F1007104A800F900820416000101A704AE000101B10416000101B7041600D900CA04C0001901EB04C6002101F404CC00D900F80016002901F800DE0031011205E500D9003305EA0039014205F00041014C05F900E1005605FE000900F800160021007B0511015101A205FE000C00F8008D005101D7051F016101E50525016901FC05290169010B062D0169011806FE005901F80032010C0042053A016101260640010C002F0644017101F8004A01210145065201210068065901810179065F0171018706640121019006520121019F0616001400F80016003100C8068E01140042053A011400D705B3012400E505C501240026064001E901F8007D00F101F800D9012000830092002E002B00E0012E003300FC012E000B00E0012E001300F6012E001B00F6012E002300F6012E00530014022E007B0063022E003B00F6012E004B00F6012E0063003E022E006B0051022E0073005A02400083009200600083009200B400D30002016A0199019E01A501AC01CA01170187019601BD0104800000E00703000100D8040000000000002A00000002000000000000000000000001007E00000000000200000000000000000000000100BB000000000002000000000000000000000001008700000000000500040000000000003C4D6F64756C653E005265706F727450726F636564757265732E646C6C0050726F63656475726573005265706F727450726F636564757265730053716C506970655574696C005265706F727450726F636564757265732E53716C546F6F6C730054797065436F6E766572746572004462547970654D6170456E747279006D73636F726C69620053797374656D004F626A6563740056616C7565547970650052657475726E446174615461626C650052657475726E51756572790053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C537472696E6700496E7365727443757272656E63795F4353002E63746F7200446174615461626C650053656E64446174615461626C654F766572506970650053797374656D2E436F6C6C656374696F6E732E47656E65726963004C6973746031005F4462547970654C697374002E6363746F7200547970650044625479706500546F4E6574547970650053716C44625479706500546F44625479706500546F53716C4462547970650046696E640063757272656E6379436F6465006E616D650074626C006462547970650073716C44625479706500747970650053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C65417474726962757465004775696441747472696275746500417373656D626C7956657273696F6E41747472696275746500417373656D626C7946696C6556657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465004D6963726F736F66742E53716C5365727665722E5365727665720053716C50726F6365647572654174747269627574650053797374656D2E446174612E53716C436C69656E740053716C436F6E6E656374696F6E0053716C436F6D6D616E6400437265617465436F6D6D616E64007365745F436F6E6E656374696F6E0053797374656D2E446174612E436F6D6D6F6E004462436F6D6D616E64007365745F436F6D6D616E64546578740053716C446174614164617074657200446244617461416461707465720046696C6C0049446973706F7361626C6500446973706F7365004462436F6E6E656374696F6E00436F6E6E656374696F6E5374617465006765745F537461746500436C6F7365004F70656E0053716C4461746152656164657200457865637574655265616465720053716C436F6E746578740053716C50697065006765745F506970650053656E640053716C506172616D65746572004462506172616D65746572007365745F56616C75650053716C506172616D65746572436F6C6C656374696F6E006765745F506172616D6574657273004164640044656275670057726974654C696E6500457865637574654E6F6E51756572790044617461436F6C756D6E436F6C6C656374696F6E006765745F436F6C756D6E7300496E7465726E616C44617461436F6C6C656374696F6E42617365006765745F436F756E740053716C4D657461446174610053797374656D2E436F6C6C656374696F6E730049456E756D657261746F7200476574456E756D657261746F72006765745F43757272656E740044617461436F6C756D6E006765745F436F6C756D6E4E616D65006765745F4461746154797065006765745F4D61784C656E677468004D6F76654E65787400546F41727261790053716C446174615265636F72640053656E64526573756C747353746172740044617461526F77436F6C6C656374696F6E006765745F526F77730044617461526F77006765745F4974656D41727261790053657456616C75650053656E64526573756C7473526F770053656E64526573756C7473456E6400426F6F6C65616E0052756E74696D655479706548616E646C65004765745479706546726F6D48616E646C650042797465004461746554696D6500446563696D616C00446F75626C65004775696400496E74313600496E74333200496E74363400537472696E6700456E756D657261746F72004170706C69636174696F6E457863657074696F6E005374727563744C61796F7574417474726962757465004C61796F75744B696E64000000002F63006F006E007400650078007400200063006F006E006E0065006300740069006F006E003D0074007200750065000033530045004C0045004300540020002A002000460052004F004D00200054005F00420065006E00750074007A00650072002000001B4000430075007200720065006E006300790043006F0064006500000B40004E0061006D0065000081650D000A0043005200450041005400450020005400410042004C0045002000640062006F002E0054005F005400650073007400430075007200720065006E00630079000D000A00280020000D000A00090020004300550052005F0043006F006400650020006E006100740069006F006E0061006C0020006300680061007200610063007400650072002000760061007200790069006E006700280031003000290020004E0055004C004C0020000D000A0009002C004300550052005F004E0061006D00650020006E006100740069006F006E0061006C0020006300680061007200610063007400650072002000760061007200790069006E0067002800350030003000290020004E0055004C004C0020000D000A0009002C004300550052005F004C006100730074004D006F0064006900660069006500640020006400610074006500740069006D00650020004E0055004C004C0020000D000A0029003B0020000D000A000080F70D000A0049004E005300450052005400200049004E0054004F002000640062006F002E0054005F005400650073007400430075007200720065006E006300790028004300550052005F0043006F00640065002C0020004300550052005F004E0061006D0065002C0020004300550052005F004C006100730074004D006F00640069006600690065006400290020000D000A00560041004C0055004500530028004000430075007200720065006E006300790043006F00640065002C00200040004E0061006D0065002C002000430055005200520045004E0054005F00540049004D0045005300540041004D005000290020000D000A00003D5200650066006500720065006E00630065006400200061006E00200075006E0073007500700070006F0072007400650064002000540079007000650000415200650066006500720065006E00630065006400200061006E00200075006E0073007500700070006F007200740065006400200044006200540079007000650000475200650066006500720065006E00630065006400200061006E00200075006E0073007500700070006F0072007400650064002000530071006C004400620054007900700065000000000058A9ACBB5E78A14B8DF3C3D96934D94D0008B77A5C561934E0890300000107000201110D110D0320000105000101121107061512150111140600011219111D06000112191121060001111D1219060001111D1121060001112112190600011121111D060001111412190600011114111D06000111141121030612190306111D03061121092003011219111D1121042001010E042001010205200101115904200101080401000000042000126D05200101126905200101126D0520010812110520001180850B07051269126D1275121102052000128089050000128091062001011280890A07041269126D12808902062002010E1121042001011C05200012809D082001128095128095040001010E032000080E07061269126D1280951280950E020520001280A507151215011280AD0520001280B10320001C0320000E0420001219072003010E11210A052001011300032000020520001D1300072001011D1280AD062001011280B90520001280BD0420001D1C05200201081C1C0709151215011280AD1280B51280AD1280B91280C1081280B102127D0615121501111407000112191180C9021D050407011114060702111412190607021114111D06070211141121092000151180F101130007151180F101111404200013000E070411141114151180F101111402062001011180FD150100105265706F727450726F63656475726573000005010000000017010012436F7079726967687420C2A920203230313600002901002434383231616562642D333531662D343063612D393266652D36646462316435313661353600001201000D323031362E332E312E3132343000000801000701000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301000000000000EA7FD55600000000020000001C010000643C0000641E00005253445330F7B47E88C7D34483DB55046390827601000000643A5C53746566616E2E537465696765725C446F63756D656E74735C56697375616C2053747564696F20323031335C50726F6A656374735C53716C536572766572537461746973746963732D6D61737465725C5265706F727450726F636564757265735C6F626A5C44656275675C5265706F727450726F636564757265732E70646200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000A83D00000000000000000000BE3D0000002000000000000000000000000000000000000000000000B03D00000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000140300000000000000000000140334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE000001000300E007D80401000300E007D80401003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00474020000010053007400720069006E006700460069006C00650049006E0066006F0000005002000001003000300030003000300034006200300000004C0011000100460069006C0065004400650073006300720069007000740069006F006E00000000005200650070006F0072007400500072006F006300650064007500720065007300000000003C000E000100460069006C006500560065007200730069006F006E000000000032003000310036002E0033002E0031002E00310032003400300000004C001500010049006E007400650072006E0061006C004E0061006D00650000005200650070006F0072007400500072006F0063006500640075007200650073002E0064006C006C00000000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003100360000005400150001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005200650070006F0072007400500072006F0063006500640075007200650073002E0064006C006C0000000000440011000100500072006F0064007500630074004E0061006D006500000000005200650070006F0072007400500072006F0063006500640075007200650073000000000040000E000100500072006F006400750063007400560065007200730069006F006E00000032003000310036002E0033002E0031002E003100320034003000000044000E00010041007300730065006D0062006C0079002000560065007200730069006F006E00000032003000310036002E0033002E0031002E003100320034003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000D03D00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
        // WITH PERMISSION_SET = UNSAFE
        // GO






        // CREATE PROCEDURE sp_ReturnPgDataTable AS 
        // EXTERNAL NAME ReportProcedures.[ReportProcedures.Procedures].ReturnPgDataTable

        // EXECUTE sp_ReturnPgDataTable;
        [Microsoft.SqlServer.Server.SqlProcedure()]
        public static void ReturnPgDataTable()
        {
            System.Data.Common.DbProviderFactory fac = AnySqlHelper.GetFactory(typeof(Npgsql.NpgsqlFactory));

            using (System.Data.Common.DbConnection conn = fac.CreateConnection())
            {
                conn.ConnectionString = AnySqlHelper.GetConnectionString();

                using (System.Data.Common.DbCommand cmd = conn.CreateCommand())
                {
                    cmd.Connection = conn;

                    //cmd.CommandText = @"SELECT * FROM dokanfs ";
                    cmd.CommandText = @"SELECT * FROM t_blogpost ";

                    using (System.Data.Common.DbDataAdapter ada = fac.CreateDataAdapter())
                    {
                        ada.SelectCommand = cmd;

                        using (System.Data.DataTable dt = new System.Data.DataTable())
                        {
                            ada.Fill(dt);
                            ReportProcedures.SqlTools.SqlPipeUtil.SendDataTableOverPipe(dt);
                        } // End Using dt 

                    } // End Using ada

                } // End using cmd 

                if (conn.State != System.Data.ConnectionState.Closed)
                    conn.Close();
            } // End using conn

        } // End Sub ReturnPgDataTable 



        // CREATE PROCEDURE sp_ReturnDataTable AS 
        // EXTERNAL NAME ReportProcedures.[ReportProcedures.Procedures].ReturnDataTable

        // EXECUTE sp_ReturnDataTable;
        [Microsoft.SqlServer.Server.SqlProcedure()]
        public static void ReturnDataTable()
        {
            System.Data.Common.DbProviderFactory fac = AnySqlHelper.GetFactory(typeof(System.Data.SqlClient.SqlClientFactory));

            using (System.Data.Common.DbConnection conn = fac.CreateConnection())
            {
                conn.ConnectionString = AnySqlHelper.GetMsConnectionString();

                using (System.Data.Common.DbCommand cmd = conn.CreateCommand())
                {
                    cmd.Connection = conn;
                    cmd.CommandText = @"SELECT * FROM T_Benutzer ";


                    using (System.Data.Common.DbDataAdapter ada = fac.CreateDataAdapter())
                    {
                        ada.SelectCommand = cmd;

                        using (System.Data.DataTable dt = new System.Data.DataTable())
                        {
                            ada.Fill(dt);
                            ReportProcedures.SqlTools.SqlPipeUtil.SendDataTableOverPipe(dt);
                        } // End Using dt 

                    } // End Using ada

                } // End Using cmd 

                if (conn.State != System.Data.ConnectionState.Closed)
                    conn.Close();
            } // End using conn

        } // End Sub ReturnDataTable 



        // CREATE PROCEDURE sp_ReturnQuery AS 
        // EXTERNAL NAME ReportProcedures.[ReportProcedures.Procedures].ReturnQuery

        // EXECUTE sp_ReturnQuery;


        // Works with safe 
        [Microsoft.SqlServer.Server.SqlProcedure()]
        public static void ReturnQuery()
        {
            using (System.Data.SqlClient.SqlConnection conn = new System.Data.SqlClient.SqlConnection("context connection=true"))
            {
                using (System.Data.SqlClient.SqlCommand cmd = conn.CreateCommand())
                {
                    cmd.Connection = conn;
                    cmd.CommandText = @"SELECT * FROM T_Benutzer ";

                    if(conn.State != System.Data.ConnectionState.Open)
                        conn.Open();

                    System.Data.SqlClient.SqlDataReader rdr = cmd.ExecuteReader();
                    Microsoft.SqlServer.Server.SqlContext.Pipe.Send(rdr);
                    // See more at: http://www.sqlteam.com/article/writing-clr-stored-procedures-in-charp-returning-data-part-2#sthash.U5dv6ARC.dpuf
                } // End Using cmd 

                if (conn.State != System.Data.ConnectionState.Closed)
                    conn.Close();
            } // End Using conn

        } // End Sub ReturnQuery 




        // CREATE PROCEDURE sp_InsertCurrency 
        //     @currencyCode NVARCHAR(10) 
        //    ,@name NVARCHAR(500) 
        // AS 
        // EXTERNAL NAME ReportProcedures.[ReportProcedures.Procedures].InsertCurrency_CS


        // DECLARE @currencyCode nvarchar(10)
        // DECLARE @name nvarchar(500)

        // SET @currencyCode = 'CHF'
        // SET @name = 'Swiss Franc'

        // EXECUTE sp_InsertCurrency @currencyCode, @name



        // Requires unsafe 
        [Microsoft.SqlServer.Server.SqlProcedure()]
        public static void InsertCurrency_CS(System.Data.SqlTypes.SqlString currencyCode, System.Data.SqlTypes.SqlString name)
        {
            using (System.Data.SqlClient.SqlConnection conn = new System.Data.SqlClient.SqlConnection("context connection=true"))
            {

                using (System.Data.SqlClient.SqlCommand cmd = conn.CreateCommand())
                {
                    System.Data.SqlClient.SqlParameter currencyCodeParam = new System.Data.SqlClient.SqlParameter("@CurrencyCode", System.Data.SqlDbType.NVarChar);
                    System.Data.SqlClient.SqlParameter nameParam = new System.Data.SqlClient.SqlParameter("@Name", System.Data.SqlDbType.NVarChar);


                    currencyCodeParam.Value = currencyCode;
                    nameParam.Value = name;

                    cmd.Parameters.Add(currencyCodeParam);
                    cmd.Parameters.Add(nameParam);

                    string strCreateTable = @"
CREATE TABLE dbo.T_TestCurrency
( 
	 CUR_Code national character varying(10) NULL 
	,CUR_Name national character varying(500) NULL 
	,CUR_LastModified datetime NULL 
); 
";
                    System.Diagnostics.Debug.WriteLine(strCreateTable);


                    cmd.CommandText = @"
INSERT INTO dbo.T_TestCurrency(CUR_Code, CUR_Name, CUR_LastModified) 
VALUES(@CurrencyCode, @Name, CURRENT_TIMESTAMP) 
";

                    if (conn.State != System.Data.ConnectionState.Open)
                        conn.Open();

                    cmd.ExecuteNonQuery();
                } // End Using cmd 

                if (conn.State != System.Data.ConnectionState.Closed)
                    conn.Close();
            } // End Using conn

        } // End Sub InsertCurrency_CS 


    } // End Class Procedures


} // End Namespace ReportProcedures
