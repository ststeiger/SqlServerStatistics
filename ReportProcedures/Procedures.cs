
// using Microsoft.SqlServer.Server;
// using System.Data.SqlTypes;

// using System.Data.SqlClient;


//using System; using System.Data; using System.Data.SqlClient; using Microsoft.SqlServer.Server;
//  See more at: http://www.sqlteam.com/article/writing-clr-stored-procedures-in-charp-returning-data-part-2#sthash.U5dv6ARC.dpuf


namespace ReportProcedures
{


    public class Procedures
    {

        // sp_configure 'show advanced options', 1;
        // GO
        // RECONFIGURE;
        // GO

        // sp_configure 'clr enabled', 1;
        // GO
        // RECONFIGURE;
        // GO

        // sp_configure 'show advanced options', 0;
        // GO
        // RECONFIGURE;
        // GO

        // EXEC sp_changedbowner 'sa'
        // ALTER DATABASE TestDb SET TRUSTWORTHY ON;


        // CREATE ASSEMBLY [ReportProcedures]
        // AUTHORIZATION [dbo]
        // FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300C69BD5560000000000000000E00002210B010B00002600000006000000000000DE45000000200000006000000000001000200000000200000400000000000000040000000000000000A000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000904500004B000000006000007003000000000000000000000000000000000000008000000C000000584400001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000E4250000002000000026000000020000000000000000000000000000200000602E7273726300000070030000006000000004000000280000000000000000000000000000400000402E72656C6F6300000C0000000080000000020000002C00000000000000000000000000004000004200000000000000000000000000000000C0450000000000004800000002000500E02B00007818000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B300200230100000100001100731100000A0A0672010000706F1200000A000620381500006F1300000A000672150000706F1400000A000672230000706F1500000A000672430000706F1600000A00D01E000001281700000A28020000060B076F1800000A0C0008066F1900000A6F1A00000A00086F1B00000A0D0009086F1C00000A000972510000706F1D00000A00076F1E00000A1304001104096F1F00000A00732000000A130500110411056F2100000A26110528080000060000DE14110514FE01130611062D0811056F2200000A00DC0000DE14110414FE01130611062D0811046F2200000A00DC0000DE120914FE01130611062D07096F2200000A00DC00086F2300000A16FE01130611062D07086F2400000A0000DE120814FE01130611062D07086F2200000A00DC002A000134000002009D0016B300140000000002008C003FCB00140000000002006F0074E300120000000002005A00B50F01120000000013300300540000000200001100022C1502D003000001281700000A6F2500000A16FE012B0117000C082D28000272850000701F186F2600000A0A0614FE010C082D100006146F2700000A74030000010B2B0C007297000070732800000A7A072A1B300200070100000300001100D029000001281700000A28020000060A066F1800000A0B00732900000A0C0872C90000706F2A00000A0008282B00000A6F2C00000A0008176F2D00000A0007086F1900000A6F1A00000A00076F1B00000A0D0009076F1C00000A000972D70000706F1D00000A00066F1E00000A1304001104096F1F00000A00732000000A130500110411056F2100000A26110528080000060000DE14110514FE01130611062D0811056F2200000A00DC0000DE14110414FE01130611062D0811046F2200000A00DC0000DE120914FE01130611062D07096F2200000A00DC00076F2300000A16FE01130611062D07076F2400000A0000DE120714FE01130611062D07076F2200000A00DC002A0001340000020081001697001400000000020070003FAF0014000000000200530074C700120000000002001800DBF30012000000001B3002008D0000000400001100720B010070732E00000A0A00066F2F00000A0B0007066F3000000A000772D70000706F1D00000A00066F2300000A17FE010D092D07066F3100000A00076F3200000A0C283300000A086F3400000A0000DE100714FE010D092D07076F2200000A00DC00066F2300000A16FE010D092D07066F2400000A0000DE100614FE010D092D07066F2200000A00DC002A000000011C0000020014003F5300100000000002000C006F7B0010000000001B300200DE0000000500001100720B010070732E00000A0A00066F2F00000A0B00723B0100701F0C733500000A0C72570100701F0C733500000A0D08028C050000016F3600000A0009038C050000016F3600000A00076F3700000A086F3800000A26076F3700000A096F3800000A26726301007013041104283900000A000772CA0200706F1D00000A00066F2300000A17FE01130511052D07066F3100000A00076F3A00000A2600DE120714FE01130511052D07076F2200000A00DC00066F2300000A16FE01130511052D07066F2400000A0000DE120614FE01130511052D07066F2200000A00DC002A0000011C0000020014008A9E00120000000002000C00BECA0012000000001E02283B00000A2A13300800260100000600001100026F3C00000A280F0000060A061F0EFE0116FE010C082D1C026F3D00000A1F0E1F106A1616166A1614733E00000A0B38EF000000061F10FE0116FE010C082D1B026F3D00000A1F10186A1B16166A1614733E00000A0B38C8000000061EFE0116FE010C082D1B026F3D00000A1E1A6A1F0A16166A1614733E00000A0B38A20000000616FE0116FE010C082D18026F3D00000A161E6A1F1316166A1614733E00000A0B2B7F061BFE0116FE010C082D19026F3D00000A181F096A1F1216166A1614733E00000A0B2B5B0618FE0116FE010C082D17026F3D00000A18176A1716166A1614733E00000A0B2B39061AFE0116FE010C082D18026F3D00000A1A1E6A1F1719166A1614733E00000A0B2B16026F3D00000A06026F3F00000A6A734000000A0B2B00072A00001B3004001F0100000700001100026F4100000A6F4200000A734300000A0A00026F4100000A6F4400000A13062B1E11066F4500000A74070000010B000728070000060C06086F4600000A000011066F4700000A130711072DD5DE1D110675240000011308110814FE01130711072D0811086F2200000A00DC00066F4800000A734900000A0D283300000A096F4A00000A0000026F4B00000A6F4400000A13062B5111066F4500000A743B0000011304001613052B1B0009110511046F4C00000A11059A6F4D00000A00001105175813051105026F4100000A6F4200000AFE04130711072DD0283300000A096F4E00000A000011066F4700000A130711072DA2DE1D110675240000011308110814FE01130711072D0811086F2200000A00DC00283300000A6F4F00000A002A00011C0000020020002F4F001D000000000200930062F5001D0000000013300400BA01000008000011735000000A8001000004001200D03C000001281700000A19182814000006007E01000004066F5100000A001200D03D000001281700000A1E1F142814000006007E01000004066F5100000A001200D00300001B281700000A171D2814000006007E01000004066F5100000A001200D03E000001281700000A1C1A2814000006007E01000004066F5100000A001200D03F000001281700000A1D1B2814000006007E01000004066F5100000A001200D040000001281700000A1E1C2814000006007E01000004066F5100000A001200D041000001281700000A1F091F0E2814000006007E01000004066F5100000A001200D042000001281700000A1F0A1F102814000006007E01000004066F5100000A001200D043000001281700000A1F0B1E2814000006007E01000004066F5100000A001200D044000001281700000A1F0C162814000006007E01000004066F5100000A001200D001000001281700000A1F0D1F172814000006007E01000004066F5100000A001200D045000001281700000A1F101F162814000006007E01000004066F5100000A001200D045000001281700000A1F101F0C2814000006007E01000004066F5100000A00002A2A02283B00000A0000002A000000133001001400000009000011000228120000060A12007B020000040B2B00072A133001001400000009000011000228130000060A12007B020000040B2B00072A13300100140000000A000011000228110000060A12007B030000040B2B00072A13300100140000000A000011000228130000060A12007B030000040B2B00072A13300100140000000B000011000228110000060A12007B040000040B2B00072A13300100140000000B000011000228120000060A12007B040000040B2B00072A1B300300860000000C0000110002D046000001281700000A285200000A16FE010C082D15D045000001281700000A1F101873140000060B2B56007E010000046F5300000A0D2B201203285400000A0A0012007B0200000402FE0116FE010C082D0500060BDE29001203285500000A0C082DD5DE0F1203FE160400001B6F2200000A00DC0072C3030070735600000A7A00072A000001100000020039002F68000F000000001B3002005A0000000D00001100007E010000046F5300000A0C2B201202285400000A0A0012007B0300000402FE0116FE010D092D0500060BDE29001202285500000A0D092DD5DE0F1202FE160400001B6F2200000A00DC007201040070735600000A7A00072A00000110000002000D002F3C000F000000001B3002005A0000000D00001100007E010000046F5300000A0C2B201202285400000A0A0012007B0400000402FE0116FE010D092D0500060BDE29001202285500000A0D092DD5DE0F1202FE160400001B6F2200000A00DC007243040070735600000A7A00072A00000110000002000D002F3C000F000000005E0002037D0200000402047D0300000402057D040000042A42534A4201000100000000000C00000076322E302E35303732370000000005006C000000EC060000237E0000580700006409000023537472696E677300000000BC1000008C0400002355530048150000100000002347554944000000581500002003000023426C6F620000000000000002000001571502080902000000FA253300160000010000004A0000000500000004000000140000001100000057000000110000000D0000000400000001000000040000000100000000000A0001000000000006008E0087000600950087000A00D000BD000600E20087000A0023010E010A00600145010A006C01B1000A008301B1000600BE01A3010A00D801B1000A00E901B10006004F023D02060066023D02060083023D020600A2023D020600BB023D020600D4023D020600EF023D0206000A033D02060042032303060056032303060064033D0206007D033D020600AD039A036300C10300000600F003D00306001004D0030A002E0445010E004B0444040E00A20444040600B00487000A00D404BD000A00F204BD000A003605BD000A006D05BD000600A40587000A00B805B1000600E5053D020600EF053D0206000E0687000A002E0618060A003F06180606006D0687000A00AF0618060A00BD0618060A00CD0618060A00E90645010A00F40645010A000A0718060A001707BD000A002D071806120057079A030A0093070E010A00B307B1000A00D407B10006000C08F9070A00430845010A006208B1000A007D08B1000600BA0887000600C20887000600C70887000600D00887000600D80887000600DF0887000600E40887000600EA0887000600F00887000600F60887000E000909FD0827002309000006002E0987000600430923030600590923030000000001000000000001000100010010001F002A00050001000100810110003B00470005000100070001010000610047000500010009000B0110006F0000000900020014003100C5012E000600E20075000600D80179000600E9017D0050200000000096009F000A000100B421000000009100E7000E0001001422000000009600F2000A0002005C2300000000960002010A00020014240000000096002D01150002001C250000000086183F011D000400242500000000960077012100040058260000000096008D0128000500A027000000009118D1010A00060066290000000081183F011D0006007429000000009600DF01360006009429000000009600DF013D000700B429000000009600F30144000800D429000000009600F3014B000900F429000000009600FC0152000A00142A000000009600FC0159000B00342A000000009100080260000C00D82A000000009100080267000D00502B00000000910008026E000E00C82B0000000086183F0181000F00000001000D02000001001202000002001F02000001002402000001002802000001002C02000001003302000001000D02000001003302000001000D02000001002C02000001000D02000001002C02000001003302000001000D02000002002C0200000300330261003F018B0069003F018B0071003F018B0079003F018B0081003F018B0089003F018B0091003F018B0099003F018B00A1003F019000A9003F018B00B1003F018B00B9003F018B00C1003F019500D1003F019B00D9003F011D00E1003F011D00E9003F011D00E90069048B00E90072049B00E9007B048B00E90088048B00E90095048B002100C204AE001900E104B50009010C05BB00010121058B0001014005BF0011014E05C50011015D058B0019007B05CC0019018D05D20041003F011D0019019F05D9002101B0051D000101C805DF000101D2051D002100D805F8002100FC05FE0031010506080141013F018B0051013F011D0051015A068B00590179061601510189068B0051019806900061013F018B00610140052E0169014E0534010101C8061D006901DB063B017901FC06410181010507470189013F015B01910123076201690144076701990153076D01A1015D077601110167077B0109003F011D0039007707900139008407BB0031003F0195013900A5077B0131003F01A5014100C807B501B901EF077B010C003F019B00B9011808C201C1012608C8010C005307CC01C1013208D2010C003B08D601C9013F01DC0181015108E30141007408EA01D9018508F001C9019308F50181019C08E3018101AB081D0014003F011D0014005307CC01090013093A0214001808400224002608520224003208D20141023F018B0049023F01750220008300A0002E002B007C022E00330098022E007300F6022E000B007C022E00130092022E001B0092022E00230092022E007B00FF022E003B0092022E004B0092022E005300B0022E006300DA022E006B00ED0260008300A00080008300A000A0008300A000E5000D011A014E017F01AD01FB01200225022C02330257026602BB0116021D024A0204800000E007030001003A050000000000002A00000002000000000000000000000001007E00000000000200000000000000000000000100B10000000000020000000B005C0000000000A5004404000000000200000000000000000000000100870000000000050004000000003C4D6F64756C653E005265706F727450726F636564757265732E646C6C0050726F63656475726573005265706F727450726F636564757265730053716C506970655574696C005265706F727450726F636564757265732E53716C546F6F6C730054797065436F6E766572746572004462547970654D6170456E747279006D73636F726C69620053797374656D004F626A6563740056616C7565547970650052657475726E5067446174615461626C650053797374656D2E446174610053797374656D2E446174612E436F6D6D6F6E00446250726F7669646572466163746F7279005479706500476574466163746F72790052657475726E446174615461626C650052657475726E51756572790053797374656D2E446174612E53716C54797065730053716C537472696E6700496E7365727443757272656E63795F4353002E63746F72004D6963726F736F66742E53716C5365727665722E5365727665720053716C4D657461446174610044617461436F6C756D6E004765744D6574614461746100446174615461626C650053656E64446174615461626C654F766572506970650053797374656D2E436F6C6C656374696F6E732E47656E65726963004C6973746031005F4462547970654C697374002E6363746F720044625479706500546F4E6574547970650053716C44625479706500546F44625479706500546F53716C4462547970650046696E6400747970650063757272656E6379436F6465006E616D6500636F6C0074626C006462547970650073716C4462547970650053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C65417474726962757465004775696441747472696275746500417373656D626C7956657273696F6E41747472696275746500417373656D626C7946696C6556657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053716C50726F636564757265417474726962757465004E706773716C004E706773716C436F6E6E656374696F6E537472696E674275696C646572007365745F486F7374007365745F506F7274007365745F4461746162617365007365745F557365724E616D65007365745F50617373776F7264004E706773716C466163746F72790052756E74696D655479706548616E646C65004765745479706546726F6D48616E646C65004462436F6E6E656374696F6E00437265617465436F6E6E656374696F6E004462436F6E6E656374696F6E537472696E674275696C646572006765745F436F6E6E656374696F6E537472696E67007365745F436F6E6E656374696F6E537472696E67004462436F6D6D616E6400437265617465436F6D6D616E64007365745F436F6E6E656374696F6E007365745F436F6D6D616E64546578740044624461746141646170746572004372656174654461746141646170746572007365745F53656C656374436F6D6D616E640046696C6C0049446973706F7361626C6500446973706F736500436F6E6E656374696F6E5374617465006765745F537461746500436C6F7365004973537562636C6173734F66004669656C64496E666F0042696E64696E67466C616773004765744669656C640047657456616C756500457863657074696F6E0053797374656D2E446174612E53716C436C69656E740053716C436C69656E74466163746F72790053716C436F6E6E656374696F6E537472696E674275696C646572007365745F496E697469616C436174616C6F6700456E7669726F6E6D656E74006765745F4D616368696E654E616D65007365745F44617461536F75726365007365745F496E746567726174656453656375726974790053716C436F6E6E656374696F6E0053716C436F6D6D616E64004F70656E0053716C4461746152656164657200457865637574655265616465720053716C436F6E746578740053716C50697065006765745F506970650053656E640053716C506172616D65746572004462506172616D65746572007365745F56616C75650053716C506172616D65746572436F6C6C656374696F6E006765745F506172616D6574657273004164640044656275670057726974654C696E6500457865637574654E6F6E5175657279006765745F4461746154797065006765745F436F6C756D6E4E616D650053716C436F6D706172654F7074696F6E73006765745F4D61784C656E6774680044617461436F6C756D6E436F6C6C656374696F6E006765745F436F6C756D6E7300496E7465726E616C44617461436F6C6C656374696F6E42617365006765745F436F756E740053797374656D2E436F6C6C656374696F6E730049456E756D657261746F7200476574456E756D657261746F72006765745F43757272656E74004D6F76654E65787400546F41727261790053716C446174615265636F72640053656E64526573756C747353746172740044617461526F77436F6C6C656374696F6E006765745F526F77730044617461526F77006765745F4974656D41727261790053657456616C75650053656E64526573756C7473526F770053656E64526573756C7473456E6400426F6F6C65616E0042797465004461746554696D6500446563696D616C00446F75626C65004775696400496E74313600496E74333200496E74363400537472696E67004E706773716C547970657300426974537472696E67005265666572656E6365457175616C7300456E756D657261746F72004170706C69636174696F6E457863657074696F6E005374727563744C61796F7574417474726962757465004C61796F75744B696E640000133100320037002E0030002E0030002E003100000D740065007300740064006200001F730073007200730077006500620073006500720076006900630065007300000D66006F006F006200610072000033530045004C0045004300540020002A002000460052004F004D00200074005F0062006C006F00670070006F00730074002000001149006E007300740061006E006300650000314400610074006100500072006F007600690064006500720020006900730020006D0069007300730069006E0067002100000D5400650073007400440042000033530045004C0045004300540020002A002000460052004F004D00200054005F00420065006E00750074007A00650072002000002F63006F006E007400650078007400200063006F006E006E0065006300740069006F006E003D007400720075006500001B4000430075007200720065006E006300790043006F0064006500000B40004E0061006D0065000081650D000A0043005200450041005400450020005400410042004C0045002000640062006F002E0054005F005400650073007400430075007200720065006E00630079000D000A00280020000D000A00090020004300550052005F0043006F006400650020006E006100740069006F006E0061006C0020006300680061007200610063007400650072002000760061007200790069006E006700280031003000290020004E0055004C004C0020000D000A0009002C004300550052005F004E0061006D00650020006E006100740069006F006E0061006C0020006300680061007200610063007400650072002000760061007200790069006E0067002800350030003000290020004E0055004C004C0020000D000A0009002C004300550052005F004C006100730074004D006F0064006900660069006500640020006400610074006500740069006D00650020004E0055004C004C0020000D000A0029003B0020000D000A000080F70D000A0049004E005300450052005400200049004E0054004F002000640062006F002E0054005F005400650073007400430075007200720065006E006300790028004300550052005F0043006F00640065002C0020004300550052005F004E0061006D0065002C0020004300550052005F004C006100730074004D006F00640069006600690065006400290020000D000A00560041004C0055004500530028004000430075007200720065006E006300790043006F00640065002C00200040004E0061006D0065002C002000430055005200520045004E0054005F00540049004D0045005300540041004D005000290020000D000A00003D5200650066006500720065006E00630065006400200061006E00200075006E0073007500700070006F0072007400650064002000540079007000650000415200650066006500720065006E00630065006400200061006E00200075006E0073007500700070006F007200740065006400200044006200540079007000650000475200650066006500720065006E00630065006400200061006E00200075006E0073007500700070006F0072007400650064002000530071006C004400620054007900700065000000EFAE6BCF3B0B05449D3FCA91CDE976E10008B77A5C561934E08903000001060001120D12110700020111151115032000010600011219121D0500010112210706151225011114060001121111290600011211112D060001112912110600011129112D060001112D1211060001112D112906000111141211060001111411290600011114112D03061211030611290306112D0920030112111129112D042001010E042001010205200101116504200101080401000000085D8B90D52F46FDA70600011211117D0520001280810320000E0520001280890620010112808105200012808D062001011280890520010812210520001180951207071275120D12808112808912808D1221020520010212110920021280990E11809D0420011C1C080703128099120D020300000E130707120D1280811280A912808912808D1221020520001280B5062001011280B10520001280B90500001280C1062001011280B90C07041280B11280B51280B902062002010E112D042001011C0520001280CD0820011280C51280C5040001010E032000081007061280B11280B51280C51280C50E0204200012110F2008010E112D0A05050A1180D51211072003010E112D0A070703112D1219020520001280D9061512250112190520001280E10320001C052001011300032000020520001D1300062001011D1219062001011280E50520001280E90420001D1C05200201081C1A0709151225011219121D12191280E51280ED081280E10212809106151225011114021D05040701111406070211141211060702111411290607021114112D050002021C1C0920001511811D011300071511811D01111404200013000E070411141114021511811D0111140E0704111411141511811D0111140206200101118129150100105265706F727450726F63656475726573000005010000000017010012436F7079726967687420C2A920203230313600002901002434383231616562642D333531662D343063612D393266652D36646462316435313661353600001201000D323031362E332E312E3133333800000801000701000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301000000000000C69BD55600000000020000001C0100007444000074260000525344538D5703EF9A6F6441993838C5227F503301000000643A5C53746566616E2E537465696765725C446F63756D656E74735C56697375616C2053747564696F20323031335C50726F6A656374735C53716C536572766572537461746973746963732D6D61737465725C5265706F727450726F636564757265735C6F626A5C44656275675C5265706F727450726F636564757265732E70646200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B84500000000000000000000CE450000002000000000000000000000000000000000000000000000C04500000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058600000140300000000000000000000140334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE000001000300E0073A0501000300E0073A0501003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00474020000010053007400720069006E006700460069006C00650049006E0066006F0000005002000001003000300030003000300034006200300000004C0011000100460069006C0065004400650073006300720069007000740069006F006E00000000005200650070006F0072007400500072006F006300650064007500720065007300000000003C000E000100460069006C006500560065007200730069006F006E000000000032003000310036002E0033002E0031002E00310033003300380000004C001500010049006E007400650072006E0061006C004E0061006D00650000005200650070006F0072007400500072006F0063006500640075007200650073002E0064006C006C00000000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003100360000005400150001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005200650070006F0072007400500072006F0063006500640075007200650073002E0064006C006C0000000000440011000100500072006F0064007500630074004E0061006D006500000000005200650070006F0072007400500072006F0063006500640075007200650073000000000040000E000100500072006F006400750063007400560065007200730069006F006E00000032003000310036002E0033002E0031002E003100330033003800000044000E00010041007300730065006D0062006C0079002000560065007200730069006F006E00000032003000310036002E0033002E0031002E003100330033003800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000C000000E03500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
        // WITH PERMISSION_SET = UNSAFE
        // GO






        // CREATE PROCEDURE sp_ReturnPgDataTable AS 
        // EXTERNAL NAME ReportProcedures.[ReportProcedures.Procedures].ReturnPgDataTable

        // EXECUTE sp_ReturnPgDataTable;
        [Microsoft.SqlServer.Server.SqlProcedure()]
        public static void ReturnPgDataTable()
        {
            System.Data.Common.DbProviderFactory fac = AnySqlHelper.GetFactory(typeof(Npgsql.NpgsqlFactory));

            using (System.Data.Common.DbConnection conn = fac.CreateConnection())
            {
                conn.ConnectionString = AnySqlHelper.GetConnectionString();

                using (System.Data.Common.DbCommand cmd = conn.CreateCommand())
                {
                    cmd.Connection = conn;

                    //cmd.CommandText = @"SELECT * FROM dokanfs ";
                    cmd.CommandText = @"SELECT * FROM t_blogpost ";

                    using (System.Data.Common.DbDataAdapter ada = fac.CreateDataAdapter())
                    {
                        ada.SelectCommand = cmd;

                        using (System.Data.DataTable dt = new System.Data.DataTable())
                        {
                            ada.Fill(dt);
                            ReportProcedures.SqlTools.SqlPipeUtil.SendDataTableOverPipe(dt);
                        } // End Using dt 

                    } // End Using ada

                } // End using cmd 

                if (conn.State != System.Data.ConnectionState.Closed)
                    conn.Close();
            } // End using conn

        } // End Sub ReturnPgDataTable 



        // CREATE PROCEDURE sp_ReturnDataTable AS 
        // EXTERNAL NAME ReportProcedures.[ReportProcedures.Procedures].ReturnDataTable

        // EXECUTE sp_ReturnDataTable;
        [Microsoft.SqlServer.Server.SqlProcedure()]
        public static void ReturnDataTable()
        {
            System.Data.Common.DbProviderFactory fac = AnySqlHelper.GetFactory(typeof(System.Data.SqlClient.SqlClientFactory));

            using (System.Data.Common.DbConnection conn = fac.CreateConnection())
            {
                conn.ConnectionString = AnySqlHelper.GetMsConnectionString();

                using (System.Data.Common.DbCommand cmd = conn.CreateCommand())
                {
                    cmd.Connection = conn;
                    cmd.CommandText = @"SELECT * FROM T_Benutzer ";


                    using (System.Data.Common.DbDataAdapter ada = fac.CreateDataAdapter())
                    {
                        ada.SelectCommand = cmd;

                        using (System.Data.DataTable dt = new System.Data.DataTable())
                        {
                            ada.Fill(dt);
                            ReportProcedures.SqlTools.SqlPipeUtil.SendDataTableOverPipe(dt);
                        } // End Using dt 

                    } // End Using ada

                } // End Using cmd 

                if (conn.State != System.Data.ConnectionState.Closed)
                    conn.Close();
            } // End using conn

        } // End Sub ReturnDataTable 



        // CREATE PROCEDURE sp_ReturnQuery AS 
        // EXTERNAL NAME ReportProcedures.[ReportProcedures.Procedures].ReturnQuery

        // EXECUTE sp_ReturnQuery;


        // Works with safe 
        [Microsoft.SqlServer.Server.SqlProcedure()]
        public static void ReturnQuery()
        {
            using (System.Data.SqlClient.SqlConnection conn = new System.Data.SqlClient.SqlConnection("context connection=true"))
            {
                using (System.Data.SqlClient.SqlCommand cmd = conn.CreateCommand())
                {
                    cmd.Connection = conn;
                    cmd.CommandText = @"SELECT * FROM T_Benutzer ";

                    if(conn.State != System.Data.ConnectionState.Open)
                        conn.Open();

                    System.Data.SqlClient.SqlDataReader rdr = cmd.ExecuteReader();
                    Microsoft.SqlServer.Server.SqlContext.Pipe.Send(rdr);
                    // See more at: http://www.sqlteam.com/article/writing-clr-stored-procedures-in-charp-returning-data-part-2#sthash.U5dv6ARC.dpuf
                } // End Using cmd 

                if (conn.State != System.Data.ConnectionState.Closed)
                    conn.Close();
            } // End Using conn

        } // End Sub ReturnQuery 




        // CREATE PROCEDURE sp_InsertCurrency 
        //     @currencyCode NVARCHAR(10) 
        //    ,@name NVARCHAR(500) 
        // AS 
        // EXTERNAL NAME ReportProcedures.[ReportProcedures.Procedures].InsertCurrency_CS


        // DECLARE @currencyCode nvarchar(10)
        // DECLARE @name nvarchar(500)

        // SET @currencyCode = 'CHF'
        // SET @name = 'Swiss Franc'

        // EXECUTE sp_InsertCurrency @currencyCode, @name



        // Requires unsafe 
        [Microsoft.SqlServer.Server.SqlProcedure()]
        public static void InsertCurrency_CS(System.Data.SqlTypes.SqlString currencyCode, System.Data.SqlTypes.SqlString name)
        {
            using (System.Data.SqlClient.SqlConnection conn = new System.Data.SqlClient.SqlConnection("context connection=true"))
            {

                using (System.Data.SqlClient.SqlCommand cmd = conn.CreateCommand())
                {
                    System.Data.SqlClient.SqlParameter currencyCodeParam = new System.Data.SqlClient.SqlParameter("@CurrencyCode", System.Data.SqlDbType.NVarChar);
                    System.Data.SqlClient.SqlParameter nameParam = new System.Data.SqlClient.SqlParameter("@Name", System.Data.SqlDbType.NVarChar);


                    currencyCodeParam.Value = currencyCode;
                    nameParam.Value = name;

                    cmd.Parameters.Add(currencyCodeParam);
                    cmd.Parameters.Add(nameParam);

                    string strCreateTable = @"
CREATE TABLE dbo.T_TestCurrency
( 
	 CUR_Code national character varying(10) NULL 
	,CUR_Name national character varying(500) NULL 
	,CUR_LastModified datetime NULL 
); 
";
                    System.Diagnostics.Debug.WriteLine(strCreateTable);


                    cmd.CommandText = @"
INSERT INTO dbo.T_TestCurrency(CUR_Code, CUR_Name, CUR_LastModified) 
VALUES(@CurrencyCode, @Name, CURRENT_TIMESTAMP) 
";

                    if (conn.State != System.Data.ConnectionState.Open)
                        conn.Open();

                    cmd.ExecuteNonQuery();
                } // End Using cmd 

                if (conn.State != System.Data.ConnectionState.Closed)
                    conn.Close();
            } // End Using conn

        } // End Sub InsertCurrency_CS 


    } // End Class Procedures


} // End Namespace ReportProcedures
